<div id=D__ID>
<!--third html start -->
    <div class="container mt-95 mb-3">
      <div class="row" >
        <!-- form container start -->
        <div class="col-12 col-lg-7 col-md-11 col-sm-12 mx-auto formbox">
          <div class="row">
            <div class="col-12">
              <!-- form start -->
              <form id="F__ID">
                 <h3>Visit information, medicare and referring doctors</h3>
                 <div class="form-group">
     				 <div class="questiongroup ">
                        <fieldset class="subquestions">
                            <label ><span class="">Please describe in 20 words or less, your reason for booking this appointment</span></label><br>
                            <textarea class="form-control"  name="Reason" id="Reason__ID" placeholder="Reason" required ></textarea>
                         </fieldset>
                     </div>
                 </div>
                 <div class="form-group">
     				 <div class="questiongroup ">
                        <fieldset class="subquestions">
                            <label ><span class="">Benefits from..</span>
                                <select name=benefits class="form-control" required>
                                    <option></option>
                                    <option>Medicare</option>
                                    <option>Department of Veterans Affairs</option>
                                    <option value='Self Funded'>Self Funded (No Benefits)</option>
                                </select>
                           </label><br>
                         </fieldset>
                     </div>
                     <div class="questiongroup " id=s1a__ID>
                        <fieldset class="subquestions">
                            <label ><span class="">Medicare Number</span>
                                <input  class="form-control" type="text" id=Medicare_number__ID name="Medicare_number" placeholder="Medicare Number" required ></label><br>
                                <div id=alert_success__ID class="alert alert-success" >
                                  <strong>Correct Medicare Number</strong>
                                </div>
                                <div id=alert_fail__ID class="alert alert-danger" >
                                  <strong>Wrong Number! Please check</strong>
                                </div>
                         </fieldset>
                     </div>
                     <div class="questiongroup " id=s1b__ID>
                        <fieldset class="subquestions">
                            <label ><span class="">Ref Number</span>
                                <input  class="form-control" type="number" min=1 max=10 name="Medicare_reference_number" placeholder="Reference Number" required >
                            </label><br>
                            <label ><span class="">Expiry Month/Year</span>
                                <input  class="form-control" type="number" min=1 max=12 name="Medicare_expiry_mm" placeholder="Month" required >
                            </label>&nbsp;/&nbsp;<br>
                            <label ><span class=""></span>
                                <input  class="form-control" type="number"  name="Medicare_expiry_yy" placeholder="Year" required >
                            </label><br>
                         </fieldset>
                     </div>
                     <div class="questiongroup " id=s2__ID>
                        <fieldset class="subquestions">
                            <label ><span class="">Department of Veterans Affairs number</span>
                                <input class="form-control" type="text" name="DVA" placeholder="DVA Number" required ></label><br>
                         </fieldset>
                     </div>
                 </div>
                 <div class="form-group">
     				 <div class="questiongroup ">
                        <fieldset class="">
                            <label ><span class="">Referring doctor</span>
                                <input class="form-control" type="text" name="Referring_doctor" placeholder="Referring doctor" required >
                           </label><br>
                           <label><span class="">Referring doctor's address</span>
                               <textarea class="form-control" name="Referring_doctor_address" placeholder="Address" required ></textarea>
                           </label><br>
                         </fieldset>
                     </div>
                 </div>
                 <div class="form-group">
     				 <div class="questiongroup ">
                        <fieldset class="">
                            <label class="checkboxes" >GP same as referring doctor
                                <input type="checkbox" name="GP_Ref" id=GP_Ref__ID>
                                <span class="check_checkmark"></span>
                           </label><br>
                         </fieldset>
                     </div>
                 </div>
                 <div class="form-group">
     				 <div class="questiongroup ">
                        <fieldset class="">
                            <label ><span class="">GP/Family doctor</span>
                                <input class="form-control" type="text" name="GP_Family_doctor" id="GP_Family_doctor__ID" placeholder="GP/Family doctor" required >
                           </label><br>
                           <label ><span class="">GP/Family doctor's address</span>
                               <textarea class="form-control" name="GP_Family_doctor_address" id="GP_Family_doctor_address__ID" placeholder="Address" required ></textarea>
                           </label><br>
                         </fieldset>
                     </div>
                 </div>
                 <button type="submit" id="submit__ID" class="btn btn-primary btn-lg">Submit</button>
              </form>
            </div>
         </div>
        </div>
      </div>
  </div>
  <script>
      function F__ID(){
          //--------------------------------------------------------
          $('#D__ID').on('load',function(){
              $('#F__ID')[0].reset();
              $('#F__ID input:checkbox').removeAttr('checked');
              $('#submit__ID').show();
              var record=$vm.vm['__ID'].op.record; if(record==undefined) record=$vm.vm['__ID'].op.input.record;
              if($vm.vm['__ID'].op.input!=undefined && $vm.vm['__ID'].op.input.readonly!=undefined) $('#submit__ID').hide();
              if($vm.vm['__ID'].op.input!=undefined && $vm.vm['__ID'].op.input.admin!=undefined) $('#admin__ID').show();
              $vm.deserialize(record,'#F__ID');
              $vm.render_file_field(record,'__ID',$('#File_Name__ID'));
              $('#alert_success__ID').hide();
              $('#alert_fail__ID').hide();
              benefits_process();
          })
          //--------------------------------------------------------
          var benefits_process=function(){
              $('#s1a__ID').hide(); $('#s1b__ID').hide(); $('#s2__ID').hide(); $('#s3__ID').hide();
              $("#s1a__ID input").prop('disabled', true);
              $("#s1b__ID input").prop('disabled', true);
              $("#s2__ID input").prop('disabled', true);
              $("#s3__ID input").prop('disabled', true);
              var benefits = $("select[name='benefits']").val();
              switch(benefits){
                  case 'Medicare':
                      $('#s1a__ID').show(); $('#s1b__ID').show();
                      $("#s1a__ID input").prop('disabled', false);
                      $("#s1b__ID input").prop('disabled', false);
                  break;
                  case 'Department of Veterans Affairs':
                      $('#s2__ID').show();
                      $("#s2__ID input").prop('disabled', false);
                  break;
                  case 'Self Funded':
                      $('#s3__ID').show();
                      $("#s3__ID input").prop('disabled', false);
                  break;
              }
          };
          //--------------------------------------------------------
          $('#GP_Ref__ID').on('change',function(){
              if($('#GP_Ref__ID:checked').val()=='on'){
                  $("#GP_Family_doctor__ID").prop("required",false);
                  $("#GP_Family_doctor_address__ID").prop("required",false);
              }
              else{
                  $("#GP_Family_doctor__ID").prop("required",true);
                  $("#GP_Family_doctor_address__ID").prop("required",true);
              }
          })
          $('#s1a__ID input[name=Medicare_number').on('change',function(){
               var mcn=$(this).val();
               var mcn1=mcn.replace(/\s/g,'');
               if(mcn1.length==10){
                   var output = [];
                   for (var i = 0; i< mcn1.length; i++) {output.push(+mcn1.charAt(i));}
                   var checksum=(output[0]*1+output[1]*3+output[2]*7+output[3]*9+output[4]*1+output[5]*3+output[6]*7+output[7]*9)%10;
                   if(checksum==parseInt(output[8])){
                       $('#alert_success__ID').show();
                       $('#alert_fail__ID').hide();
                       //alert_validation="";
                   }
                   else{
                       $('#alert_success__ID').hide();
                       $('#alert_fail__ID').show();
                       //alert_validation="Please check for wrong Entry";
                       //$('#ModalLabel').html('Error!');
                   }
               }
              else {
                  $('#alert_success__ID').hide();
                  $('#alert_fail__ID').show();
                  //alert_validation="Please check for wrong Entry";
                  //$('#ModalLabel').html('Error!');
              }
          })
          //--------------------------------------------------------
          var currentYear = (new Date).getFullYear();
          $('#s1b__ID input[name=Medicare_expiry_yy]').prop('min',currentYear).prop('max',currentYear+5);
          //--------------------------------------------------------
          $("select[name='benefits']").on('change',function(){
              benefits_process();
          })
          //-------------------------------------
          $('#F__ID').submit(function(event){
              //--------------------------------------------------------
              event.preventDefault();
              $('#submit__ID').hide();
              //--------------------------------------------------------
              var data=$vm.serialize('#F__ID'); var dbv={}
              //file.1. set as upload_unsuccessful
              var num=$vm.set_file_name_as_upload_unsuccessful(data,$('#F__ID'));
  			//--------------------------------------------------------
              _before_submit(data,dbv);
              //--------------------------------------------------------
              var db_pid=$vm.module_list[$vm.vm['__ID'].name].table_id;
              var rid=undefined; if($vm.vm['__ID'].op.record!=undefined) rid=$vm.vm['__ID'].op.record.ID;
              var req={cmd:"add_json_record_s2",db_pid:db_pid,data:data,dbv:dbv};
              if(rid!=undefined) req={cmd:"modify_json_record_s2",rid:rid,db_pid:db_pid,data:data,dbv:dbv};
              var old_rid=rid;
              $VmAPI.request({data:req,callback:function(res){
                  if(num>0){
  					//file.2. upload files
  					if(rid==undefined)	rid=res.ret;
  	                $vm.upload_form_files(rid,$('#F__ID'),function(){
  	                    var data=$vm.get_original_file_name($('#F__ID'));
  	                    var req={cmd:"modify_json_record",rid:rid,db_pid:db_pid,data:data,dbv:{}};
  						//file.3. recorver name
  	        			$VmAPI.request({data:req,callback:function(res){
                              $vm.refresh=1;
                              if(old_rid!=undefined) window.history.go(-1);
                              else if($vm.vm['__ID'].op.input!=undefined && $vm.vm['__ID'].op.input.goback!=undefined) window.history.go(-1);
                              else $vm.alert('Your data has been successfully submitted');
  	                    }})
  	                })
  				}
  				else{
                      $vm.refresh=1;
                      if(old_rid!=undefined) window.history.go(-1);
                      else if($vm.vm['__ID'].op.input!=undefined && $vm.vm['__ID'].op.input.goback!=undefined) window.history.go(-1);
                      else $vm.alert('Your data has been successfully submitted');
  				}
              }});
              //--------------------------------------------------------
          })
          //--------------------------------------------------------
          var _before_submit=function(data,dbv){
              if($vm.coq_participant!=undefined){
                  data.Participant=$vm.coq_participant;
                  data.Participant_uid=$vm.coq_participant_uid;
                  dbv.S1=$vm.coq_visit;
                  dbv.PPID=$vm.coq_participant_pid;
                  dbv.PUID=$vm.coq_participant_uid;
              }
          }
          //--------------------------------------------------------
  	}
  </script>
  <style>
    #D__ID{
      height:100%;
      animation: vm_module_fadein 1.0s;
      /*background-color: #fff;*/
      overflow:auto;
    }
  </style>
  VmInclude:__CURRENT_PATH__/task-form.css
  </div>
